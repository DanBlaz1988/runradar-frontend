<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RunRadar Admin</title>
  <meta name="robots" content="noindex, nofollow">
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#080b10;--bg2:#0d1117;--bg3:#111820;--border:rgba(255,255,255,0.07);--border-bright:rgba(255,255,255,0.12);--text:#e8eef6;--text-secondary:#8a9ab5;--text-muted:#4a5568;--green:#00e676;--gdim:rgba(0,230,118,0.1);--gborder:rgba(0,230,118,0.2);--red:#ff4d4d;--rdim:rgba(255,77,77,0.1);--rborder:rgba(255,77,77,0.2);--cyan:#00b4d8;--font:'Space Grotesk',sans-serif;--mono:'JetBrains Mono',monospace}
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{font-family:var(--font);background:var(--bg);color:var(--text);min-height:100vh}

    /* LOGIN */
    .login-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;background:radial-gradient(ellipse at center,rgba(0,230,118,0.04),transparent 70%)}
    .login-box{background:var(--bg2);border:1px solid var(--border-bright);border-radius:16px;padding:40px 36px;width:100%;max-width:380px;position:relative}
    .login-box::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--green),transparent);border-radius:16px 16px 0 0}
    .brand{display:flex;align-items:center;gap:8px;font-weight:700;font-size:1.1rem}
    .dot{width:8px;height:8px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);flex-shrink:0}
    .login-title{font-size:1.3rem;font-weight:700;margin:20px 0 6px}
    .login-sub{font-size:0.85rem;color:var(--text-muted);margin-bottom:24px}
    .err-box{background:var(--rdim);border:1px solid var(--rborder);color:var(--red);border-radius:8px;padding:10px 14px;font-size:0.84rem;margin-bottom:14px;display:none}
    .err-box.show{display:block}

    /* ADMIN */
    .admin-screen{display:none}
    .admin-screen.show{display:block}
    .topbar{background:var(--bg2);border-bottom:1px solid var(--border);padding:14px 0;position:sticky;top:0;z-index:50}
    .ti{max-width:960px;margin:0 auto;padding:0 20px;display:flex;align-items:center;gap:12px}
    .tpbadge{background:var(--gdim);border:1px solid var(--gborder);color:var(--green);font-size:0.7rem;font-weight:700;padding:2px 10px;border-radius:999px;text-transform:uppercase;letter-spacing:0.08em}
    .tpa{margin-left:auto;display:flex;gap:10px}
    .btn-ghost{font-size:0.8rem;font-weight:600;padding:7px 16px;border-radius:6px;cursor:pointer;font-family:var(--font);border:1px solid var(--border-bright);background:none;color:var(--text-secondary);text-decoration:none;display:inline-block;transition:all 0.2s}
    .btn-ghost:hover{border-color:var(--rborder);color:var(--red)}

    .body{max-width:960px;margin:0 auto;padding:28px 20px;display:grid;grid-template-columns:1fr 340px;gap:20px}
    @media(max-width:720px){.body{grid-template-columns:1fr}}

    .card{background:var(--bg2);border:1px solid var(--border);border-radius:14px;padding:22px;margin-bottom:18px}
    .card:last-child{margin-bottom:0}
    .card-hd{font-size:0.8rem;font-weight:700;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:18px}

    label{display:block;font-size:0.73rem;color:var(--text-muted);font-weight:600;margin-bottom:4px;letter-spacing:0.05em;text-transform:uppercase}
    input,textarea,select{width:100%;background:var(--bg3);border:1px solid var(--border-bright);border-radius:8px;color:var(--text);font-family:var(--font);font-size:0.87rem;padding:10px 12px;margin-bottom:14px;transition:border-color 0.2s;outline:none}
    input:focus,textarea:focus,select:focus{border-color:var(--green)}
    textarea{min-height:180px;resize:vertical;line-height:1.6;font-family:var(--mono);font-size:0.79rem}
    .hint{font-size:0.72rem;color:var(--text-muted);margin-top:-10px;margin-bottom:14px}

    .btn-green{background:var(--green);color:#000;font-weight:700;font-size:0.9rem;padding:11px;border-radius:8px;cursor:pointer;border:none;font-family:var(--font);width:100%;transition:all 0.2s}
    .btn-green:hover{background:#00ff88}
    .btn-green:disabled{opacity:0.5;cursor:not-allowed}
    .btn-cancel{background:none;border:1px solid var(--border-bright);color:var(--text-secondary);font-size:0.87rem;font-weight:600;padding:9px;border-radius:8px;cursor:pointer;font-family:var(--font);width:100%;margin-top:8px;transition:all 0.2s}
    .btn-cancel:hover{border-color:var(--rborder);color:var(--red)}

    .msg{margin-top:12px;padding:11px 14px;border-radius:8px;font-size:0.83rem;display:none}
    .msg.ok{background:var(--gdim);border:1px solid var(--gborder);color:var(--green);display:block}
    .msg.err{background:var(--rdim);border:1px solid var(--rborder);color:var(--red);display:block}
    .edit-notice{background:rgba(0,180,216,0.08);border:1px solid rgba(0,180,216,0.25);color:var(--cyan);border-radius:8px;padding:9px 13px;font-size:0.82rem;margin-bottom:14px;display:none}
    .edit-notice.show{display:block}

    .stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:var(--border);border-radius:10px;overflow:hidden;margin-bottom:18px}
    .stat{background:var(--bg3);padding:13px;text-align:center}
    .stat-v{font-family:var(--mono);font-size:1.3rem;font-weight:700;color:var(--green)}
    .stat-l{font-size:0.67rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em;margin-top:2px}

    .post-row{background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:11px 13px;margin-bottom:8px}
    .post-top{display:flex;align-items:center;gap:8px}
    .post-info{flex:1;min-width:0}
    .post-t{font-size:0.83rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .post-m{font-size:0.7rem;color:var(--text-muted);margin-top:2px}
    .badge{font-size:0.66rem;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;padding:2px 8px;border-radius:999px;flex-shrink:0}
    .badge.run{background:var(--gdim);color:var(--green);border:1px solid var(--gborder)}
    .badge.seo{background:rgba(0,180,216,0.1);color:var(--cyan);border:1px solid rgba(0,180,216,0.2)}
    .post-actions{display:flex;gap:6px;margin-top:9px;padding-top:9px;border-top:1px solid var(--border)}
    .btn-action{font-size:0.75rem;font-weight:600;padding:5px 12px;border-radius:5px;cursor:pointer;font-family:var(--font);transition:all 0.2s;border:1px solid var(--border-bright);background:none;color:var(--text-secondary)}
    .btn-action.edit:hover{border-color:var(--cyan);color:var(--cyan)}
    .btn-action.view{color:var(--cyan);border-color:rgba(0,180,216,0.3)}
    .btn-action.view:hover{background:rgba(0,180,216,0.1)}
    .btn-action.del:hover{border-color:var(--rborder);color:var(--red);background:var(--rdim)}
    .empty{text-align:center;padding:28px;color:var(--text-muted);font-size:0.84rem}
  </style>
</head>
<body>

<div class="login-screen" id="ls">
  <div class="login-box">
    <div class="brand"><div class="dot"></div>RunRadar</div>
    <div class="login-title">Admin Access</div>
    <div class="login-sub">Enter your admin key to continue.</div>
    <div class="err-box" id="lerr">Incorrect admin key.</div>
    <label>Admin Key</label>
    <input type="password" id="lkey" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
    <button class="btn-green" onclick="doLogin()">Unlock ‚Üí</button>
  </div>
</div>

<div class="admin-screen" id="as">
  <div class="topbar">
    <div class="ti">
      <div class="brand"><div class="dot"></div>RunRadar</div>
      <span class="tpbadge">Admin</span>
      <div class="tpa">
        <a href="/blog" class="btn-ghost">‚Üê Blog</a>
        <button class="btn-ghost" onclick="doLogout()">Logout</button>
      </div>
    </div>
  </div>

  <div class="body">
    <div>
      <div class="card">
        <div class="card-hd" id="form-hd">‚úçÔ∏è New Blog Post</div>
        <div class="edit-notice" id="edit-notice"></div>
        <label>Title</label>
        <input type="text" id="f-title" placeholder="e.g. What Is On-Chain Momentum Tracking?">
        <label>Meta Description (for Google)</label>
        <input type="text" id="f-meta" placeholder="One sentence for search engines...">
        <label>Post Type</label>
        <select id="f-type">
          <option value="seo">üìö Education / SEO</option>
          <option value="run">üèÅ Run Report</option>
        </select>
        <label>Cover Image URL</label>
        <input type="text" id="f-img" placeholder="https://i.imgur.com/... (leave blank = auto Unsplash)">
        <div class="hint">Tip: upload to imgur.com ‚Üí get direct .jpg link</div>
        <label>Content (HTML)</label>
        <textarea id="f-content" placeholder="<p>Write your article...</p>&#10;<h2>Section</h2>&#10;<p>More...</p>"></textarea>
        <div class="hint">Tags: &lt;p&gt; &lt;h2&gt; &lt;h3&gt; &lt;ul&gt; &lt;li&gt; &lt;strong&gt;</div>
        <button class="btn-green" id="f-btn" onclick="submitPost()">Publish Post ‚Üí</button>
        <button class="btn-cancel" id="f-cancel" onclick="cancelEdit()" style="display:none">‚úï Cancel Edit</button>
        <div class="msg" id="f-msg"></div>
      </div>
    </div>

    <div>
      <div class="card">
        <div class="card-hd">üìä Stats</div>
        <div class="stats-row">
          <div class="stat"><div class="stat-v" id="s-t">‚Äî</div><div class="stat-l">Total</div></div>
          <div class="stat"><div class="stat-v" id="s-r">‚Äî</div><div class="stat-l">Runs</div></div>
          <div class="stat"><div class="stat-v" id="s-s">‚Äî</div><div class="stat-l">SEO</div></div>
        </div>
      </div>
      <div class="card">
        <div class="card-hd">üìã Recent Posts</div>
        <div id="posts-list"><div class="empty">Loading...</div></div>
      </div>
    </div>
  </div>
</div>

<script>
var API='https://app.runradar.app', SK='rr_ak', editSlug=null, postsCache=[];

function doLogin(){var k=document.getElementById('lkey').value.trim();if(!k)return;sessionStorage.setItem(SK,k);showAdmin();}
function doLogout(){sessionStorage.removeItem(SK);document.getElementById('as').classList.remove('show');document.getElementById('ls').style.display='flex';document.getElementById('lkey').value='';}
function showAdmin(){document.getElementById('ls').style.display='none';document.getElementById('as').classList.add('show');loadPosts();}
window.addEventListener('load',function(){if(sessionStorage.getItem(SK))showAdmin();});
document.addEventListener('keydown',function(e){if(e.key==='Enter'&&document.getElementById('ls').style.display!=='none')doLogin();});

function getKey(){return sessionStorage.getItem(SK)||'';}

function startEdit(slug){
  var p=postsCache.find(function(x){return x.slug===slug;});
  if(!p)return;
  editSlug=slug;
  document.getElementById('f-title').value=p.title||'';
  document.getElementById('f-meta').value=p.meta_description||'';
  document.getElementById('f-content').value=p.content||'';
  document.getElementById('f-img').value=p.image_url||'';
  document.getElementById('f-type').value=p.post_type||'seo';
  document.getElementById('form-hd').textContent='‚úèÔ∏è Edit Post';
  document.getElementById('edit-notice').textContent='Editing: '+slug;
  document.getElementById('edit-notice').classList.add('show');
  document.getElementById('f-btn').textContent='Save Changes ‚Üí';
  document.getElementById('f-cancel').style.display='block';
  document.getElementById('f-msg').className='msg';
  window.scrollTo({top:0,behavior:'smooth'});
}

function cancelEdit(){
  editSlug=null;
  ['f-title','f-meta','f-content','f-img'].forEach(function(id){document.getElementById(id).value='';});
  document.getElementById('f-type').value='seo';
  document.getElementById('form-hd').textContent='‚úçÔ∏è New Blog Post';
  document.getElementById('edit-notice').classList.remove('show');
  document.getElementById('f-btn').textContent='Publish Post ‚Üí';
  document.getElementById('f-cancel').style.display='none';
  document.getElementById('f-msg').className='msg';
}

async function submitPost(){
  var btn=document.getElementById('f-btn'),msg=document.getElementById('f-msg');
  msg.className='msg';
  var title=document.getElementById('f-title').value.trim();
  var content=document.getElementById('f-content').value.trim();
  if(!title||!content){msg.className='msg err';msg.textContent='‚ùå Title and content required.';return;}
  btn.disabled=true;btn.textContent=editSlug?'Saving...':'Publishing...';
  var payload={admin_key:getKey(),title,content,
    meta_description:document.getElementById('f-meta').value.trim()||title.substring(0,150),
    image_url:document.getElementById('f-img').value.trim(),
    post_type:document.getElementById('f-type').value};
  try{
    var url=editSlug?API+'/api/blog/'+editSlug:API+'/api/blog';
    var method=editSlug?'PUT':'POST';
    var r=await fetch(url,{method,headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    var d=await r.json();
    if(d.ok){msg.className='msg ok';msg.textContent=editSlug?'‚úÖ Saved!':'‚úÖ Published! /blog/'+d.slug;cancelEdit();loadPosts();}
    else if(r.status===401){msg.className='msg err';msg.textContent='‚ùå Wrong key.';doLogout();}
    else{msg.className='msg err';msg.textContent='‚ùå '+(d.error||'Error');}
  }catch(e){msg.className='msg err';msg.textContent='‚ùå '+e.message;}
  btn.disabled=false;btn.textContent=editSlug?'Save Changes ‚Üí':'Publish Post ‚Üí';
}

async function deletePost(slug,title){
  if(!confirm('Delete "'+title+'"?\n\nThis cannot be undone.'))return;
  try{
    var r=await fetch(API+'/api/blog/'+slug+'?admin_key='+encodeURIComponent(getKey()),{method:'DELETE',headers:{'X-Admin-Key':getKey()}});
    var d=await r.json();
    if(d.ok){loadPosts();}
    else{alert('Error: '+(d.error||'Could not delete'));}
  }catch(e){alert('Network error: '+e.message);}
}

async function loadPosts(){
  try{
    var r=await fetch(API+'/api/blog?limit=100');
    var posts=await r.json();
    postsCache=posts||[];
    var list=document.getElementById('posts-list');
    if(!posts||!posts.length){
      list.innerHTML='<div class="empty">No posts yet.</div>';
      ['s-t','s-r','s-s'].forEach(function(id){document.getElementById(id).textContent='0';});
      return;
    }
    document.getElementById('s-t').textContent=posts.length;
    document.getElementById('s-r').textContent=posts.filter(function(p){return p.post_type==='run';}).length;
    document.getElementById('s-s').textContent=posts.filter(function(p){return p.post_type!=='run';}).length;
    list.innerHTML=posts.map(function(p){
      var d=new Date(p.created_at).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});
      var t=p.post_type==='run'?'run':'seo';
      var safeTitle=(p.title||'').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
      return '<div class="post-row">'+
        '<div class="post-top">'+
        '<div class="post-info"><div class="post-t">'+p.title+'</div><div class="post-m">'+d+'</div></div>'+
        '<span class="badge '+t+'">'+t+'</span>'+
        '</div>'+
        '<div class="post-actions">'+
        '<button class="btn-action edit" onclick="startEdit(\''+p.slug+'\')">‚úèÔ∏è Edit</button>'+
        '<a class="btn-action view" href="/blog/'+p.slug+'" target="_blank">üëÅ View</a>'+
        '<button class="btn-action del" onclick="deletePost(\''+p.slug+'\',\''+safeTitle+'\')">üóë Delete</button>'+
        '</div></div>';
    }).join('');
  }catch(e){document.getElementById('posts-list').innerHTML='<div class="empty">Could not load posts.</div>';}
}
</script>
</body>
</html>
